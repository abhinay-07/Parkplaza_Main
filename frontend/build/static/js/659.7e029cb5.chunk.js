"use strict";(self.webpackChunkparkplaza_frontend=self.webpackChunkparkplaza_frontend||[]).push([[659],{659:(e,o,n)=>{n.d(o,{A:()=>l});var t=n(9950),r=n(4758),i=n(4414);const l=e=>{let{parkingLots:o=[],userLocation:n=null,selectedLotId:l=null,onMarkerClick:a=null,onParkingLotSelect:s=null,height:d="400px",zoom:c=13,showUserLocation:u=!0,recenterOnSelect:g=!1,needPlaces:f=!1,lazy:p=!0,idleDelay:w=0,debug:m=!1,allowFullscreen:v=!0,autoFullscreen:y=!0,autoFallback:h=!0}=e;const b=(0,t.useRef)(null),x=(0,t.useRef)(null),[k,E]=(0,t.useState)(null),L=(0,t.useRef)(new Map),[_,S]=(0,t.useState)(!0),[M,j]=(0,t.useState)(null),[C,z]=(0,t.useState)(!1),[A,I]=(0,t.useState)(!1),[P,G]=(0,t.useState)(!1),[$,R]=(0,t.useState)(!p),T=(0,t.useRef)(!1),[F,B]=(0,t.useState)(!1);if((0,t.useEffect)(()=>{if(!p)return;if(!x.current)return;const e=x.current,o=new IntersectionObserver(e=>{e.forEach(e=>{e.isIntersecting&&(R(!0),o.disconnect(),m&&console.log("[GoogleMaps] Visible via IntersectionObserver"))})},{rootMargin:"100px"});return o.observe(e),()=>o.disconnect()},[p]),(0,t.useEffect)(()=>{if(!p||$)return;const e=setTimeout(()=>{$||(T.current=!0,R(!0),m&&console.warn("[GoogleMaps] Forcing visibility after timeout fallback"))},4e3);return()=>clearTimeout(e)},[p,$,m]),(0,t.useEffect)(()=>{var e;if(!$)return;let o=!1;m&&"undefined"!==typeof window&&(window.GMAPS_DEBUG=!0,console.log("[GoogleMaps] Debug enabled"));const t="AIzaSyBjZE83cbz9_NMyGZqpajV4kNiuVB-fr0Q";const i=null===(e=b.current)||void 0===e?void 0:e.__mapInstance;return i?(E(i),S(!1),void(m&&console.log("[GoogleMaps] Reusing existing map instance"))):((async()=>{w>0&&await new Promise(e=>setTimeout(e,w));try{m&&console.log("[GoogleMaps] Loading SDK\u2026",{needPlaces:f,idleDelay:w});const e=await(0,r.A)(t,{libraries:f?["places"]:[],retry:2,timeoutMs:8e3});if(o||!b.current)return;G(!0);const i=n||{lat:28.6139,lng:77.209},l=new e.maps.Map(b.current,{center:i,zoom:c,mapTypeControl:!0,streetViewControl:!0,fullscreenControl:!0,zoomControl:!0,styles:[{featureType:"poi.business",elementType:"labels",stylers:[{visibility:"off"}]}]});if(b.current.__mapInstance=l,o)return;E(l),S(!1),m&&console.log("[GoogleMaps] Map initialized")}catch(e){if(o)return;console.error("Error loading Google Maps:",e),j("Failed to load Google Maps"),S(!1),m&&console.error("[GoogleMaps] Init error",e)}})(),()=>{o=!0})},[f,$,w]),(0,t.useEffect)(()=>{if(!v||!y)return;if(!x.current)return;const e=x.current,o=()=>{const o=e.getBoundingClientRect();!F&&(o.height<240||o.width<320)&&(B(!0),m&&console.log("[GoogleMaps] Auto fullscreen due to small container",o))};o();const n=new ResizeObserver(()=>o());return n.observe(e),()=>n.disconnect()},[v,y,F,m]),(0,t.useEffect)(()=>{if(!F)return;const e=e=>{"Escape"===e.key&&B(!1)};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[F]),(0,t.useEffect)(()=>{k&&P&&u&&n&&(k.__userMarker?k.__userMarker.setPosition(n):k.__userMarker=new window.google.maps.Marker({position:n,map:k,title:"Your Location",icon:{url:'data:image/svg+xml;charset=UTF-8,%3csvg width="24" height="24" xmlns="http://www.w3.org/2000/svg"%3e%3ccircle cx="12" cy="12" r="8" fill="%234285F4"/%3e%3ccircle cx="12" cy="12" r="4" fill="white"/%3e%3c/svg%3e',scaledSize:new window.google.maps.Size(24,24),anchor:new window.google.maps.Point(12,12)}}))},[k,P,n,u]),(0,t.useEffect)(()=>{if(!k||!o)return;const e=a||s;for(const[l,a]of L.current.entries())o.find(e=>String(e.id)===String(l))||(a.marker.setMap(null),L.current.delete(l));const n=new window.google.maps.LatLngBounds;let t=!1;const r=o=>{if("number"!==typeof(null===o||void 0===o?void 0:o.lat)||"number"!==typeof(null===o||void 0===o?void 0:o.lng))return;t=!0;const r=String(o.id),i={lat:o.lat,lng:o.lng};n.extend(i);const l=o.totalSlots?o.availableSlots/o.totalSlots:0;let a="#ef4444";l>.5?a="#22c55e":l>.2&&(a="#eab308");const s={url:`data:image/svg+xml;charset=UTF-8,%3csvg width="32" height="40" xmlns="http://www.w3.org/2000/svg"%3e%3cpath d="M16 0C7.2 0 0 7.2 0 16c0 16 16 24 16 24s16-8 16-24C32 7.2 24.8 0 16 0z" fill="${a}"/%3e%3ccircle cx="16" cy="16" r="6" fill="white"/%3e%3ctext x="16" y="20" text-anchor="middle" font-family="Arial" font-size="10" font-weight="bold" fill="${a}"%3eP%3c/text%3e%3c/svg%3e`,scaledSize:new window.google.maps.Size(32,40),anchor:new window.google.maps.Point(16,40)};let d=L.current.get(r);if(d)d.marker.setPosition(i),d.marker.setIcon(s);else{var c;const n=new window.google.maps.Marker({position:i,map:k,title:o.name,icon:s}),t=new window.google.maps.InfoWindow({content:`\n            <div style="padding:12px;max-width:260px;font-family:Arial,sans-serif;">\n              <h3 style="margin:0 0 6px;color:#1f2937;font-size:15px;">${o.name}</h3>\n              <div style="margin:4px 0;color:#6b7280;font-size:13px;">\ud83d\udccd ${o.address||""}</div>\n              <div style="display:flex;justify-content:space-between;margin:6px 0;font-size:12px;">\n                <div style="text-align:center;">\n                  <div style="font-weight:600;color:${a};">${o.availableSlots}/${o.totalSlots}</div>\n                  <div style="color:#6b7280;">Avail</div>\n                </div>\n                <div style="text-align:center;">\n                  <div style="font-weight:600;color:#1f2937;">\u20b9${(null===(c=o.pricePerHour)||void 0===c?void 0:c.day)||"-"} /hr</div>\n                  <div style="color:#6b7280;">Day</div>\n                </div>\n                <div style="text-align:center;">\n                  <div style="font-weight:600;color:#1f2937;">${o.rating||"\u2014"}\u2b50</div>\n                  <div style="color:#6b7280;">Rating</div>\n                </div>\n              </div>\n              <div style="display:flex;gap:6px;">\n                <button onclick="window.viewParkingLotDetails('${r}')" style="background:#3b82f6;color:#fff;border:none;padding:6px 8px;border-radius:6px;font-size:12px;cursor:pointer;flex:1;font-weight:500;">Details</button>\n                <button onclick="window.bookParkingLot('${r}')" style="background:#16a34a;color:#fff;border:none;padding:6px 8px;border-radius:6px;font-size:12px;cursor:pointer;flex:1;font-weight:500;">Book Now</button>\n              </div>\n            </div>`});n.addListener("click",()=>{t.open(k,n),e&&e(o),g&&(k.setCenter(i),k.setZoom(16))}),d={marker:n,infoWindow:t},L.current.set(r,d)}},i=[...o];let d=0;const c=()=>{i.slice(d,d+25).forEach(r),d+=25,d<i.length&&(window.requestIdleCallback?window.requestIdleCallback(c,{timeout:100}):requestAnimationFrame(c)),d>=i.length&&!l&&t&&o.length>1&&k.fitBounds(n)};m&&console.log("[GoogleMaps] Creating markers for lots:",(null===o||void 0===o?void 0:o.length)||0),c()},[k,o,a,s,g,l]),(0,t.useEffect)(()=>{if(!k||!l)return;const e=L.current.get(String(l));e&&(e.infoWindow.open(k,e.marker),g&&(k.setCenter(e.marker.getPosition()),k.setZoom(16)))},[k,l,g]),"undefined"===typeof window||window.viewParkingLotDetails||(window.viewParkingLotDetails=e=>{window.location.href=`/parking-lot/${e}`}),"undefined"===typeof window||window.bookParkingLot||(window.bookParkingLot=e=>{const o=`/booking?lotId=${e}`;localStorage.getItem("token")?window.location.href=o:window.location.href=`/auth?from=${encodeURIComponent(o)}`}),(0,t.useEffect)(()=>{if(!$||P)return;const e=setTimeout(()=>{var e;null!==(e=window.google)&&void 0!==e&&e.maps||z(!0)},5e3);return()=>clearTimeout(e)},[$,P]),(0,t.useEffect)(()=>{if(!h)return;if(!$||P||A)return;const e=setTimeout(()=>{var e;null!==(e=window.google)&&void 0!==e&&e.maps||P||(m&&console.warn("[GoogleMaps] Auto fallback: Google Maps not available"),I(!0))},9e3);return()=>clearTimeout(e)},[h,$,P,A,m]),(0,t.useEffect)(()=>{A&&(async()=>{try{if(!document.querySelector("link[data-leaflet]")){const e=document.createElement("link");e.rel="stylesheet",e.href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css",e.setAttribute("data-leaflet",""),document.head.appendChild(e)}if(window.L||await new Promise((e,o)=>{const n=document.createElement("script");n.src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js",n.async=!0,n.onload=e,n.onerror=o,document.head.appendChild(n)}),b.current&&!b.current.__leafletMap){const e=n||{lat:28.6139,lng:77.209},t=window.L.map(b.current).setView([e.lat,e.lng],c);window.L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:19,attribution:"&copy; OpenStreetMap contributors"}).addTo(t),b.current.__leafletMap=t,o.forEach(e=>{"number"===typeof(null===e||void 0===e?void 0:e.lat)&&"number"===typeof(null===e||void 0===e?void 0:e.lng)&&window.L.marker([e.lat,e.lng]).addTo(t).bindPopup(`<strong>${e.name}</strong><br/>${e.address||""}`)})}}catch(e){console.error("Leaflet fallback failed",e)}})()},[A,o,n,c]),_&&!$)return(0,i.jsx)("div",{ref:x,style:{height:d,display:"flex",alignItems:"center",justifyContent:"center",background:"#f3f4f6",borderRadius:"8px"},children:(0,i.jsx)("span",{style:{fontSize:12,color:"#6b7280"},children:"Map deferred\u2026 scroll into view"})});if(_)return(0,i.jsx)("div",{ref:x,style:{height:d,display:"flex",alignItems:"center",justifyContent:"center"},children:(0,i.jsxs)("div",{style:{width:"100%",height:"100%",position:"relative"},children:[(0,i.jsx)("div",{style:{position:"absolute",inset:0,background:"#e5e7eb",animation:"pulse 1.5s ease-in-out infinite"}}),(0,i.jsx)("style",{children:"@keyframes pulse {0%,100%{opacity:0.6;}50%{opacity:1;}}"}),(0,i.jsx)("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%,-50%)",fontSize:12,color:"#374151"},children:"Loading map\u2026"})]})});if(M&&!A)return(0,i.jsx)("div",{style:{height:d,position:"relative",display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:"#fef2f2",border:"1px solid #fecaca",borderRadius:"8px",color:"#dc2626",padding:"20px",textAlign:"center"},children:(0,i.jsxs)("div",{children:[(0,i.jsx)("p",{style:{margin:"0 0 8px 0",fontWeight:"bold"},children:"Error Loading Map"}),(0,i.jsx)("p",{style:{margin:0,fontSize:"14px"},children:M}),(0,i.jsx)("button",{onClick:()=>I(!0),style:{marginTop:12,background:"#2563eb",color:"#fff",border:"none",padding:"6px 12px",borderRadius:6,cursor:"pointer",fontSize:13},children:"Use Fallback Map"}),(0,i.jsx)("pre",{style:{marginTop:8,textAlign:"left",whiteSpace:"pre-wrap",color:"#7f1d1d"},children:JSON.stringify({hasGoogle:!!window.google,script:!!document.getElementById("gmaps-sdk"),keyFromEnv:!0},null,2)})]})});const D=F?{position:"fixed",inset:0,zIndex:9999,width:"100vw",height:"100vh",background:"#fff"}:{height:d,width:"100%",borderRadius:"8px",overflow:"hidden",position:"relative"};return(0,i.jsxs)("div",{ref:x,style:D,children:[(0,i.jsx)("div",{ref:b,style:{width:"100%",height:"100%"}}),v&&(0,i.jsxs)("div",{style:{position:"absolute",top:8,left:8,display:"flex",gap:8,zIndex:10},children:[!F&&(0,i.jsx)("button",{onClick:()=>B(!0),title:"Fullscreen",style:{background:"rgba(0,0,0,0.6)",color:"#fff",border:"none",padding:"6px 10px",borderRadius:6,cursor:"pointer",fontSize:12},children:"Fullscreen"}),F&&(0,i.jsx)("button",{onClick:()=>B(!1),title:"Exit fullscreen (Esc)",style:{background:"rgba(0,0,0,0.6)",color:"#fff",border:"none",padding:"6px 10px",borderRadius:6,cursor:"pointer",fontSize:12},children:"Exit"})]}),C&&!P&&!A&&(0,i.jsxs)("div",{style:{position:"absolute",top:8,right:8,background:"rgba(0,0,0,0.65)",color:"#fff",padding:"8px 10px",borderRadius:6,fontSize:12,maxWidth:260},children:[(0,i.jsx)("strong",{style:{display:"block",marginBottom:4},children:"Map Diagnostics"}),!1,(0,i.jsx)("div",{children:"Key present (env)"}),!1,!1,(0,i.jsxs)("div",{style:{marginTop:4},children:["window.google: ",window.google?"defined":"undefined"]}),(0,i.jsxs)("div",{style:{marginTop:4},children:["Script tag: ",document.getElementById("gmaps-sdk")?"found":"not found"]}),(0,i.jsxs)("div",{style:{marginTop:6,display:"flex",gap:6},children:[(0,i.jsx)("button",{onClick:()=>{z(!1),I(!0)},style:{background:"#3b82f6",color:"#fff",border:"none",padding:"4px 8px",borderRadius:4,cursor:"pointer"},children:"Fallback"}),(0,i.jsx)("button",{onClick:()=>{window.location.reload()},style:{background:"#6b7280",color:"#fff",border:"none",padding:"4px 8px",borderRadius:4,cursor:"pointer"},children:"Reload"})]})]})]})}},4758:(e,o,n)=>{n.d(o,{A:()=>l});let t=null,r=new Set,i=new Set;function l(e){var o;let{libraries:n=[],retry:l=0,timeoutMs:a=15e3,language:s,region:d,nonce:c}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const u=!("undefined"===typeof window||!window.GMAPS_DEBUG),g=function(){for(var e=arguments.length,o=new Array(e),n=0;n<e;n++)o[n]=arguments[n];u&&console.log("[gmaps-loader]",...o)},f=function(){for(var e=arguments.length,o=new Array(e),n=0;n<e;n++)o[n]=arguments[n];u&&console.warn("[gmaps-loader]",...o)},p=function(){for(var e=arguments.length,o=new Array(e),n=0;n<e;n++)o[n]=arguments[n];u&&console.error("[gmaps-loader]",...o)};if(null!==(o=window.google)&&void 0!==o&&o.maps)return null!==n&&void 0!==n&&n.length&&n.forEach(e=>{if(!r.has(e)){"places"!==e||!!window.google.maps.places||f("Already loaded without requested library:",e)}}),Promise.resolve(window.google);if((n||[]).forEach(e=>i.add(e)),t)return t;const w=o=>new Promise((n,t)=>{var l;if(null!==(l=window.google)&&void 0!==l&&l.maps)return g("window.google.maps already present"),n(window.google);let u=document.getElementById("gmaps-sdk");u||(u=document.createElement("script"),u.id="gmaps-sdk",c&&(u.nonce=c),u.async=!0,u.defer=!0,document.head.appendChild(u));let w=!1;"undefined"!==typeof window&&(window.gm_authFailure=()=>{w=!0,p("gm_authFailure: API key or referrer not authorized")}),"undefined"!==typeof window&&(window.__gm_cb=()=>{g("google callback fired (__gm_cb)")},window.__gm_cb2=()=>{g("google callback fired (__gm_cb2)")},window.__gm_cb3=()=>{g("google callback fired (__gm_cb3)")}),u.src=function(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;const n=Array.from(i).sort(),t=!("undefined"===typeof window||!window.GMAPS_NO_ASYNC)||o>1,r=!("undefined"===typeof window||!window.GMAPS_USE_CALLBACK)||o>2;return[`https://maps.googleapis.com/maps/api/js?key=${encodeURIComponent(e)}`,"v=weekly",t?null:"loading=async",n.length?`libraries=${encodeURIComponent(n.join(","))}`:null,s?`language=${encodeURIComponent(s)}`:null,d?`region=${encodeURIComponent(d)}`:null,r?`callback=__gm_cb${o>1?o:""}`:null].filter(Boolean).join("&")}(o),g("injecting script",{src:u.src,attempt:o});const m=async()=>{var e;if(null!==(e=window.google)&&void 0!==e&&e.maps)if(w)t(new Error("Google Maps auth failed (gm_authFailure)"));else{try{if(window.google.maps.importLibrary){const e=Array.from(new Set(["maps",...Array.from(i)]));g("importLibrary start",e),await Promise.all(e.map(e=>window.google.maps.importLibrary(e))),g("importLibrary done"),e.forEach(e=>r.add(e))}else i.has("places")&&!window.google.maps.places&&f("places requested but importLibrary unavailable; relying on libraries param")}catch(o){p("importLibrary failed:",(null===o||void 0===o?void 0:o.message)||o)}n(window.google)}else t(new Error("Google Maps loaded but window.google.maps is undefined"))},v=e=>{u.removeEventListener("load",m),u.removeEventListener("error",v),p("script error",e),t(e||new Error("Failed to load Google Maps script"))};u.addEventListener("load",m,{once:!0}),u.addEventListener("error",v,{once:!0});const y=setTimeout(()=>{u.removeEventListener("load",m),u.removeEventListener("error",v),p("timeout",o),t(new Error(`Loading Google Maps timed out (attempt ${o})`))},Math.max(5e3,a)),h=e=>{clearTimeout(y),e&&(u.removeEventListener("load",h),u.removeEventListener("error",h))};u.addEventListener("load",h,{once:!0}),u.addEventListener("error",h,{once:!0})}),m=Math.max(1,1+Number(l||0));return t=(async()=>{if("undefined"!==typeof window&&window.GMAPS_USE_OFFICIAL_LOADER)try{var o;g("trying official @googlemaps/js-api-loader");const n=await import("@googlemaps/js-api-loader").catch(e=>{throw e}),r=(null===n||void 0===n?void 0:n.Loader)||(null===n||void 0===n||null===(o=n.default)||void 0===o?void 0:o.Loader)||(null===n||void 0===n?void 0:n.default);if(r){const o=new r({apiKey:e,version:"weekly",libraries:Array.from(i)});await o.importLibrary("maps");for(const e of i)try{await o.importLibrary(e)}catch(t){f("official loader: failed lib",e,(null===t||void 0===t?void 0:t.message)||t)}return g("official loader done"),window.google}}catch(t){p("official loader failed, falling back",(null===t||void 0===t?void 0:t.message)||t)}let n;for(let e=1;e<=m;e+=1)try{if(e>1){const o=Math.min(2e3*e,6e3);f(`retrying (${e}/${m}) in ${o}ms`),await new Promise(e=>setTimeout(e,o))}return await w(e)}catch(t){n=t,p("load attempt failed:",(null===t||void 0===t?void 0:t.message)||t);const e=document.getElementById("gmaps-sdk");if(e&&e.parentNode)try{e.parentNode.removeChild(e)}catch(r){}}throw n||new Error("Failed to load Google Maps")})(),t}}}]);