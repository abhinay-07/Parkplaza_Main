"use strict";(self.webpackChunkparkplaza_frontend=self.webpackChunkparkplaza_frontend||[]).push([[562],{8562:(e,s,a)=>{a.r(s),a.d(s,{default:()=>m});var t=a(9950),l=a(8429),r=a(732),i=a(6680),n=a(5175),d=a(7443),o=a(4414);const c=e=>{let{lotId:s,onSelect:a}=e;const[l,i]=(0,t.useState)([]),[c,x]=(0,t.useState)(!0),[m,u]=(0,t.useState)(null),[g,h]=(0,t.useState)(null);(0,t.useEffect)(()=>{(async()=>{x(!0);try{if((0,d.e)(s)){const e=Array.from({length:24}).map((e,s)=>{let a="available";return s%7===0?a="occupied":s%5===0&&(a="reserved"),{code:`L1-R${String(Math.floor(s/6)+1).padStart(2,"0")}-C${String(s%6+1).padStart(2,"0")}`,type:"car",level:1,status:a,position:{x:s%6*2,y:0,z:4*Math.floor(s/6)}}});i(e)}else{var e;const a=await n.A.getSlots(s);i((null===(e=a.data)||void 0===e?void 0:e.slots)||a.data||[])}u(null)}catch(a){console.warn("Slot load failed",a),u("Failed to load slots")}x(!1)})()},[s]);const b=l.reduce((e,s)=>(e[s.level]=e[s.level]||[],e[s.level].push(s),e),{});return c?(0,o.jsx)("div",{className:"py-6",children:(0,o.jsx)(r.A,{message:"Loading slots..."})}):m?(0,o.jsx)("div",{className:"text-red-600 text-sm",children:m}):l.length?(0,o.jsx)("div",{className:"relative",style:{perspective:"1200px"},children:Object.keys(b).sort((e,s)=>e-s).map(e=>(0,o.jsxs)("div",{className:"mb-8",children:[(0,o.jsxs)("h4",{className:"text-sm font-semibold text-gray-700 mb-2",children:["Level ",e]}),(0,o.jsx)("div",{className:"overflow-auto border rounded-lg p-4 bg-white shadow-sm",children:(0,o.jsx)("div",{className:"relative",style:{transformStyle:"preserve-3d"},children:(0,o.jsx)("div",{className:"grid gap-2",style:{gridTemplateColumns:"repeat(auto-fill, minmax(60px,1fr))"},children:b[e].map(e=>{const s=g===e.code,t="available"!==e.status,l="available"===e.status?"bg-green-100 text-green-700":"bg-gray-200 text-gray-500";return(0,o.jsxs)("button",{disabled:t,onClick:()=>(e=>{h(e.code),null===a||void 0===a||a(e)})(e),className:`h-14 flex flex-col items-center justify-center text-xs border rounded-md transition-all ${t?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-gray-50 hover:bg-blue-50"} ${s?"ring-2 ring-blue-500 bg-blue-100":""}`,title:e.code,children:[(0,o.jsx)("span",{className:"font-medium",children:e.code.split("-").slice(-1)}),(0,o.jsx)("span",{className:`mt-1 px-1 rounded text-[10px] ${l}`,children:e.status})]},e.code)})})})})]},e))}):(0,o.jsx)("div",{className:"text-gray-500 text-sm",children:"No slots available"})},x=c;c.defaultProps={onSelect:null};const m=()=>{var e;const s=(0,l.zy)(),a=(0,l.Zp)(),n=new URLSearchParams(s.search).get("lotId");(0,t.useEffect)(()=>{if(!localStorage.getItem("token")){alert("Please login to book a parking slot");try{const e=`${s.pathname}${s.search||""}`;sessionStorage.setItem("postLoginRedirect",e)}catch{}a("/auth",{state:{from:s}})}},[a,s]);const[d,c]=(0,t.useState)("car"),[m,u]=(0,t.useState)(""),[g,h]=(0,t.useState)(""),[b,p]=(0,t.useState)([]),[v,j]=(0,t.useState)(null),{parkingLot:y,loading:N,error:f}=(0,i.r)(n),{services:w,loading:S}=(0,i.A$)(n),{priceData:k,loading:D,calculatePrice:C,resetPrice:T}=(0,i._6)();(0,t.useEffect)(()=>{(async()=>{if(n&&m&&g)try{await C(n,new Date(m).toISOString(),new Date(g).toISOString(),b)}catch(e){console.warn("Price calculation failed",e)}else T()})()},[n,m,g,b]),(0,t.useEffect)(()=>{const e=new Date,s=new Date(e.getTime()+72e5),a=e=>e.toISOString().slice(0,16);u(a(e)),h(a(s))},[]);const L=(()=>{if(!m||!g)return 0;const e=new Date(m),s=new Date(g);return Math.max(0,Math.ceil((s-e)/36e5))})();return n?N?(0,o.jsx)("div",{className:"min-h-screen bg-gray-50",children:(0,o.jsx)("div",{className:"max-w-4xl mx-auto px-4 py-8",children:(0,o.jsx)(r.A,{message:"Loading booking details..."})})}):f||!y?(0,o.jsx)("div",{className:"min-h-screen bg-gray-50",children:(0,o.jsx)("div",{className:"max-w-4xl mx-auto px-4 py-8",children:(0,o.jsxs)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-6 text-center",children:[(0,o.jsx)("h2",{className:"text-xl font-semibold text-red-800 mb-2",children:"Parking Lot Not Found"}),(0,o.jsx)("p",{className:"text-red-600 mb-4",children:f||"The parking lot you are trying to book is not available."}),(0,o.jsx)("button",{onClick:()=>a("/"),className:"bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-lg",children:"Back to Home"})]})})}):(0,o.jsx)("div",{className:"min-h-screen bg-gray-50",children:(0,o.jsxs)("div",{className:"max-w-4xl mx-auto px-4 py-8",children:[(0,o.jsxs)("div",{className:"mb-8",children:[(0,o.jsxs)("button",{onClick:()=>a(-1),className:"flex items-center text-blue-600 hover:text-blue-700 mb-4",children:[(0,o.jsx)("svg",{className:"w-5 h-5 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,o.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})}),"Back"]}),(0,o.jsx)("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Book Parking Spot"}),(0,o.jsx)("p",{className:"text-lg text-gray-600",children:y.name})]}),(0,o.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[(0,o.jsxs)("div",{className:"lg:col-span-2 space-y-6",children:[(0,o.jsxs)("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:[(0,o.jsx)("h2",{className:"text-xl font-semibold text-gray-900 mb-4",children:"Select Slot Type"}),(0,o.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:null===(e=y.slotTypes)||void 0===e?void 0:e.map(e=>(0,o.jsxs)("button",{onClick:()=>c(e.type),className:"border-2 rounded-lg p-4 text-left transition-colors "+(d===e.type?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300"),disabled:0===e.available,children:[(0,o.jsxs)("div",{className:"flex items-center mb-2",children:[(0,o.jsx)("div",{className:"p-2 bg-gray-100 rounded-lg mr-3",children:"car"===e.type?(0,o.jsxs)("svg",{className:"w-5 h-5 text-gray-600",fill:"currentColor",viewBox:"0 0 20 20",children:[(0,o.jsx)("path",{d:"M4 16a2 2 0 100-4 2 2 0 000 4zM16 16a2 2 0 100-4 2 2 0 000 4z"}),(0,o.jsx)("path",{fillRule:"evenodd",d:"M3 4a1 1 0 00-1 1v10a1 1 0 102 0V5a1 1 0 001-1h12a1 1 0 001 1v10a1 1 0 102 0V5a1 1 0 00-1-1H3z",clipRule:"evenodd"})]}):(0,o.jsx)("svg",{className:"w-5 h-5 text-gray-600",fill:"currentColor",viewBox:"0 0 20 20",children:(0,o.jsx)("path",{d:"M3 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 15a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z"})})}),(0,o.jsxs)("div",{children:[(0,o.jsxs)("h3",{className:"font-semibold capitalize",children:[e.type," Parking"]}),(0,o.jsxs)("p",{className:"text-sm text-gray-600",children:["\u20b9",e.price,"/hour"]})]})]}),(0,o.jsx)("p",{className:"text-sm text-gray-500",children:e.available>0?`${e.available} slots available`:"Fully booked"})]},e.type))}),(0,o.jsxs)("div",{className:"mt-6",children:[(0,o.jsx)("h3",{className:"text-lg font-semibold text-gray-800 mb-3",children:"Choose Specific Slot (Optional)"}),(0,o.jsx)("p",{className:"text-xs text-gray-500 mb-3",children:"Pick an exact slot from the layout below. If you skip, one will be auto-assigned."}),(0,o.jsx)(x,{lotId:n,onSelect:j}),v&&(0,o.jsxs)("div",{className:"mt-3 text-sm text-green-700 bg-green-50 border border-green-200 rounded p-2",children:["Selected Slot: ",(0,o.jsx)("strong",{children:v.code})]})]})]}),(0,o.jsxs)("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:[(0,o.jsx)("h2",{className:"text-xl font-semibold text-gray-900 mb-4",children:"Select Date & Time"}),(0,o.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[(0,o.jsxs)("div",{children:[(0,o.jsx)("label",{htmlFor:"startDateTime",className:"block text-sm font-medium text-gray-700 mb-2",children:"Start Date & Time"}),(0,o.jsx)("input",{id:"startDateTime",type:"datetime-local",value:m,onChange:e=>u(e.target.value),min:(new Date).toISOString().slice(0,16),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),(0,o.jsxs)("div",{children:[(0,o.jsx)("label",{htmlFor:"endDateTime",className:"block text-sm font-medium text-gray-700 mb-2",children:"End Date & Time"}),(0,o.jsx)("input",{id:"endDateTime",type:"datetime-local",value:g,onChange:e=>h(e.target.value),min:m,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]})]}),L>0&&(0,o.jsx)("div",{className:"mt-4 p-3 bg-blue-50 rounded-lg",children:(0,o.jsxs)("p",{className:"text-sm text-blue-700",children:["Duration: ",(0,o.jsxs)("span",{className:"font-medium",children:[L," hours"]})]})})]}),(0,o.jsxs)("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:[(0,o.jsx)("h2",{className:"text-xl font-semibold text-gray-900 mb-4",children:"Additional Services"}),S?(0,o.jsx)("div",{className:"text-center py-4",children:(0,o.jsx)(r.A,{message:"Loading services..."})}):w.length?(0,o.jsx)("div",{className:"space-y-4",children:w.map(e=>(0,o.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,o.jsx)("input",{type:"checkbox",id:`service-${e.id}`,checked:b.includes(e.id),onChange:()=>{return s=e.id,void p(e=>e.includes(s)?e.filter(e=>e!==s):[...e,s]);var s},className:"mt-1 w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),(0,o.jsx)("div",{className:"flex-1",children:(0,o.jsxs)("label",{htmlFor:`service-${e.id}`,className:"flex items-center cursor-pointer",children:[(0,o.jsx)("div",{className:"text-xl mr-3",children:e.icon}),(0,o.jsxs)("div",{className:"flex-1",children:[(0,o.jsxs)("div",{className:"flex items-center justify-between",children:[(0,o.jsx)("h3",{className:"font-medium text-gray-900",children:e.name}),(0,o.jsxs)("span",{className:"text-lg font-semibold text-gray-900",children:["\u20b9",e.price,"per-kwh"===e.priceType&&"/kWh"]})]}),(0,o.jsx)("p",{className:"text-sm text-gray-600 mt-1",children:e.description}),(0,o.jsxs)("div",{className:"flex items-center justify-between mt-2",children:[(0,o.jsxs)("span",{className:"text-xs text-gray-500",children:["Duration: ",e.duration," min"]}),e.popular&&(0,o.jsx)("span",{className:"bg-yellow-100 text-yellow-800 text-xs px-2 py-1 rounded-full",children:"Popular"})]})]})]})})]},e.id))}):(0,o.jsx)("p",{className:"text-gray-500 text-center py-4",children:"No additional services available"})]})]}),(0,o.jsx)("div",{className:"lg:col-span-1",children:(0,o.jsxs)("div",{className:"bg-white rounded-lg border border-gray-200 p-6 sticky top-4",children:[(0,o.jsx)("h2",{className:"text-xl font-semibold text-gray-900 mb-4",children:"Booking Summary"}),(0,o.jsxs)("div",{className:"mb-4 pb-4 border-b border-gray-200",children:[(0,o.jsx)("h3",{className:"font-medium text-gray-900",children:y.name}),(0,o.jsx)("p",{className:"text-sm text-gray-600",children:y.address})]}),(0,o.jsxs)("div",{className:"space-y-3 mb-4 pb-4 border-b border-gray-200",children:[(0,o.jsxs)("div",{className:"flex justify-between",children:[(0,o.jsx)("span",{className:"text-gray-600",children:"Slot Type:"}),(0,o.jsx)("span",{className:"font-medium capitalize",children:d})]}),(0,o.jsxs)("div",{className:"flex justify-between",children:[(0,o.jsx)("span",{className:"text-gray-600",children:"Duration:"}),(0,o.jsxs)("span",{className:"font-medium",children:[L," hours"]})]}),m&&(0,o.jsxs)("div",{className:"flex justify-between",children:[(0,o.jsx)("span",{className:"text-gray-600",children:"Start:"}),(0,o.jsxs)("span",{className:"font-medium text-sm",children:[new Date(m).toLocaleDateString()," at"," ",new Date(m).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})]})]}),g&&(0,o.jsxs)("div",{className:"flex justify-between",children:[(0,o.jsx)("span",{className:"text-gray-600",children:"End:"}),(0,o.jsxs)("span",{className:"font-medium text-sm",children:[new Date(g).toLocaleDateString()," at"," ",new Date(g).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})]})]})]}),(0,o.jsx)("div",{className:"space-y-2 mb-4",children:D?(0,o.jsx)("div",{className:"text-center py-2",children:(0,o.jsx)("div",{className:"w-6 h-6 border-2 border-blue-600 border-t-transparent rounded-full animate-spin mx-auto"})}):k?(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)("div",{className:"flex justify-between",children:[(0,o.jsx)("span",{className:"text-gray-600",children:"Parking Fee:"}),(0,o.jsxs)("span",{className:"font-medium",children:["\u20b9",null!==(P=null!==(I=k.parkingCost)&&void 0!==I?I:null===k||void 0===k||null===(z=k.pricing)||void 0===z?void 0:z.basePrice)&&void 0!==P?P:0]})]}),(null!==(M=null!==($=k.servicesCost)&&void 0!==$?$:null===k||void 0===k||null===(A=k.pricing)||void 0===A?void 0:A.serviceFees)&&void 0!==M?M:0)>0&&(0,o.jsxs)("div",{className:"flex justify-between",children:[(0,o.jsx)("span",{className:"text-gray-600",children:"Services:"}),(0,o.jsxs)("span",{className:"font-medium",children:["\u20b9",null!==(B=null!==(F=k.servicesCost)&&void 0!==F?F:null===k||void 0===k||null===(O=k.pricing)||void 0===O?void 0:O.serviceFees)&&void 0!==B?B:0]})]}),(null!==(E=null!==(H=k.tax)&&void 0!==H?H:null===k||void 0===k||null===(R=k.pricing)||void 0===R?void 0:R.taxes)&&void 0!==E?E:0)>0&&(0,o.jsxs)("div",{className:"flex justify-between",children:[(0,o.jsx)("span",{className:"text-gray-600",children:"Tax:"}),(0,o.jsxs)("span",{className:"font-medium",children:["\u20b9",null!==(_=null!==(q=k.tax)&&void 0!==q?q:null===k||void 0===k||null===(V=k.pricing)||void 0===V?void 0:V.taxes)&&void 0!==_?_:0]})]}),(0,o.jsx)("div",{className:"border-t border-gray-200 pt-2 mt-2",children:(0,o.jsxs)("div",{className:"flex justify-between",children:[(0,o.jsx)("span",{className:"text-lg font-semibold text-gray-900",children:"Total:"}),(0,o.jsxs)("span",{className:"text-lg font-semibold text-gray-900",children:["\u20b9",null!==(W=null!==(U=k.total)&&void 0!==U?U:null===k||void 0===k||null===(Z=k.pricing)||void 0===Z?void 0:Z.totalAmount)&&void 0!==W?W:0]})]})})]}):(0,o.jsx)("div",{className:"text-gray-500 text-center py-2",children:"Select dates to see pricing"})}),(0,o.jsx)("button",{onClick:()=>{var e;if(!m||!g||!n)return void alert("Please fill in all required fields");const s={parkingLotId:n,slotType:d,startDateTime:new Date(m).toISOString(),endDateTime:new Date(g).toISOString(),services:b,totalAmount:(null===k||void 0===k?void 0:k.total)||(null===k||void 0===k||null===(e=k.pricing)||void 0===e?void 0:e.totalAmount)||0,slotCode:(null===v||void 0===v?void 0:v.code)||null};a("/payment",{state:{bookingData:s,parkingLot:y}})},disabled:!m||!g||!k||D,className:"w-full bg-green-600 text-white py-3 px-4 rounded-lg font-medium hover:bg-green-700 disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors",children:D?"Calculating...":"Proceed to Payment"}),(0,o.jsx)("p",{className:"text-xs text-gray-500 mt-3 text-center",children:"By booking, you agree to our terms and conditions"})]})})]})]})}):(0,o.jsx)("div",{className:"min-h-screen bg-gray-50",children:(0,o.jsx)("div",{className:"max-w-4xl mx-auto px-4 py-8",children:(0,o.jsxs)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-6 text-center",children:[(0,o.jsx)("h2",{className:"text-xl font-semibold text-red-800 mb-2",children:"Invalid Booking Request"}),(0,o.jsx)("p",{className:"text-red-600 mb-4",children:"No parking lot selected for booking."}),(0,o.jsx)("button",{onClick:()=>a("/"),className:"bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-lg",children:"Back to Home"})]})})});var P,I,z,M,$,A,B,F,O,E,H,R,_,q,V,W,U,Z}}}]);