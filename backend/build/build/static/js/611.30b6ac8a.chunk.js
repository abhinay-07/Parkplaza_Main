"use strict";(self.webpackChunkparkplaza_frontend=self.webpackChunkparkplaza_frontend||[]).push([[611],{4611:(e,s,a)=>{a.r(s),a.d(s,{default:()=>d});var r=a(9950),t=a(8429),l=(a(732),a(9826)),i=a(4414);const d=()=>{const e=(0,t.zy)(),s=(0,t.Zp)(),{bookingData:a,parkingLot:d}=e.state||{},[n,o]=(0,r.useState)("credit-card"),[c,m]=(0,r.useState)(!1),[x,u]=(0,r.useState)(!1),[h,g]=(0,r.useState)(!1),[b,p]=(0,r.useState)(""),[y,v]=(0,r.useState)(""),[j,f]=(0,r.useState)(null),[N,k]=(0,r.useState)({cardNumber:"",expiryDate:"",cvv:"",holderName:"",upiId:"",walletProvider:"paytm"});if(!a||!d)return(0,i.jsx)("div",{className:"min-h-screen bg-gray-50",children:(0,i.jsx)("div",{className:"max-w-4xl mx-auto px-4 py-8",children:(0,i.jsxs)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-6 text-center",children:[(0,i.jsx)("h2",{className:"text-xl font-semibold text-red-800 mb-2",children:"Invalid Payment Request"}),(0,i.jsx)("p",{className:"text-red-600 mb-4",children:"No booking data found. Please start over."}),(0,i.jsx)("button",{onClick:()=>s("/"),className:"bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-lg",children:"Back to Home"})]})})});const w=e=>{const{name:s,value:a}=e.target;k(e=>({...e,[s]:a}))},C=e=>{const s=new Date(e);return{date:s.toLocaleDateString(),time:s.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}},P=C(a.startDateTime),D=C(a.endDateTime),T=Math.ceil((new Date(a.endDateTime)-new Date(a.startDateTime))/36e5);return(0,i.jsx)("div",{className:"min-h-screen bg-gray-50",children:(0,i.jsxs)("div",{className:"max-w-4xl mx-auto px-4 py-8",children:[(0,i.jsxs)("div",{className:"mb-8",children:[(0,i.jsxs)("button",{onClick:()=>s(-1),className:"flex items-center text-blue-600 hover:text-blue-700 mb-4",children:[(0,i.jsx)("svg",{className:"w-5 h-5 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,i.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})}),"Back"]}),(0,i.jsx)("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Complete Payment"}),(0,i.jsx)("p",{className:"text-lg text-gray-600",children:"Secure your parking spot"})]}),h?(0,i.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[(0,i.jsxs)("div",{className:"lg:col-span-2 space-y-6",children:[(0,i.jsxs)("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:[(0,i.jsx)("h2",{className:"text-xl font-semibold text-gray-900 mb-4",children:"Confirm Booking Details"}),(0,i.jsxs)("div",{className:"space-y-4",children:[(0,i.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{className:"text-sm text-gray-600",children:"Parking Lot"}),(0,i.jsx)("div",{className:"font-medium",children:d.name}),(0,i.jsx)("div",{className:"text-sm text-gray-600",children:d.address})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{className:"text-sm text-gray-600",children:"Slot Type"}),(0,i.jsx)("div",{className:"font-medium capitalize",children:a.slotType})]})]}),(0,i.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{className:"text-sm text-gray-600",children:"Check-in"}),(0,i.jsxs)("div",{className:"font-medium",children:[P.date," at ",P.time]})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{className:"text-sm text-gray-600",children:"Check-out"}),(0,i.jsxs)("div",{className:"font-medium",children:[D.date," at ",D.time]})]})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Vehicle License Plate"}),(0,i.jsx)("input",{type:"text",value:b,onChange:e=>p(e.target.value),placeholder:"e.g. KA01AB1234",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"}),y&&(0,i.jsx)("p",{className:"text-sm text-red-600 mt-2",children:y})]})]})]}),(0,i.jsxs)("div",{className:"flex gap-3",children:[(0,i.jsx)("button",{onClick:()=>g(!1),className:"px-4 py-2 rounded-lg border border-gray-300 text-gray-700 hover:bg-gray-50",children:"Back to Payment"}),(0,i.jsx)("button",{onClick:async()=>{if(j)if(v(""),!b||b.trim().length<3)v("Please enter a valid license plate");else{u(!0);try{var e;const r={parkingLot:j.lotId,vehicle:{type:a.slotType||"car",licensePlate:b.trim().toUpperCase()},bookingDetails:{startTime:j.startTime,endTime:j.endTime,spotNumber:a.slotCode||void 0},services:j.services||[],payment:{method:"credit-card"===j.paymentMethod?"card":j.paymentMethod,simulate:!0}},t=await l.A.create(r),i=(null===t||void 0===t||null===(e=t.booking)||void 0===e?void 0:e._id)||(null===t||void 0===t?void 0:t._id)||(null===t||void 0===t?void 0:t.id);s("/my-bookings",{state:{highlightBookingId:i}})}catch(r){console.error("Booking confirmation failed:",r),v((null===r||void 0===r?void 0:r.message)||"Failed to create booking. Please try again.")}finally{u(!1)}}},disabled:x,className:"px-4 py-2 rounded-lg bg-green-600 text-white hover:bg-green-700 disabled:bg-gray-400",children:x?"Confirming\u2026":"Confirm & Create Booking"})]})]}),(0,i.jsx)("div",{className:"lg:col-span-1",children:(0,i.jsxs)("div",{className:"bg-white rounded-lg border border-gray-200 p-6 sticky top-4",children:[(0,i.jsx)("h2",{className:"text-xl font-semibold text-gray-900 mb-4",children:"Order Summary"}),(0,i.jsx)("div",{className:"space-y-3 mb-4 pb-4 border-b border-gray-200",children:(0,i.jsxs)("div",{className:"flex justify-between",children:[(0,i.jsx)("span",{className:"text-gray-600",children:"Duration:"}),(0,i.jsxs)("span",{className:"font-medium",children:[T," hours"]})]})}),(0,i.jsx)("div",{className:"mb-6",children:(0,i.jsxs)("div",{className:"flex justify-between text-lg font-semibold text-gray-900",children:[(0,i.jsx)("span",{children:"Total Amount:"}),(0,i.jsxs)("span",{children:["\u20b9",a.totalAmount]})]})}),(0,i.jsx)("p",{className:"text-xs text-gray-500",children:"Your payment is processed. Confirm to create the booking and view it in My Bookings."})]})})]}):(0,i.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[(0,i.jsxs)("div",{className:"lg:col-span-2 space-y-6",children:[(0,i.jsxs)("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:[(0,i.jsx)("h2",{className:"text-xl font-semibold text-gray-900 mb-4",children:"Payment Method"}),(0,i.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4 mb-6",children:[{id:"credit-card",label:"Credit/Debit Card",icon:"\ud83d\udcb3"},{id:"upi",label:"UPI",icon:"\ud83d\udcf1"},{id:"wallet",label:"Digital Wallet",icon:"\ud83d\udcb0"}].map(e=>(0,i.jsxs)("button",{onClick:()=>o(e.id),className:"border-2 rounded-lg p-4 text-center transition-colors "+(n===e.id?"border-blue-500 bg-blue-50 text-blue-700":"border-gray-200 hover:border-gray-300 text-gray-700"),children:[(0,i.jsx)("div",{className:"text-2xl mb-2",children:e.icon}),(0,i.jsx)("div",{className:"text-sm font-medium",children:e.label})]},e.id))}),"credit-card"===n&&(0,i.jsxs)("div",{className:"space-y-4",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Card Holder Name"}),(0,i.jsx)("input",{type:"text",name:"holderName",value:N.holderName,onChange:w,placeholder:"John Doe",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Card Number"}),(0,i.jsx)("input",{type:"text",name:"cardNumber",value:N.cardNumber,onChange:w,placeholder:"1234 5678 9012 3456",maxLength:"19",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),(0,i.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Expiry Date"}),(0,i.jsx)("input",{type:"text",name:"expiryDate",value:N.expiryDate,onChange:w,placeholder:"MM/YY",maxLength:"5",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"CVV"}),(0,i.jsx)("input",{type:"text",name:"cvv",value:N.cvv,onChange:w,placeholder:"123",maxLength:"3",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]})]})]}),"upi"===n&&(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"UPI ID"}),(0,i.jsx)("input",{type:"text",name:"upiId",value:N.upiId,onChange:w,placeholder:"username@paytm",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),"wallet"===n&&(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select Wallet"}),(0,i.jsxs)("select",{name:"walletProvider",value:N.walletProvider,onChange:w,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[(0,i.jsx)("option",{value:"paytm",children:"Paytm"}),(0,i.jsx)("option",{value:"phonepe",children:"PhonePe"}),(0,i.jsx)("option",{value:"gpay",children:"Google Pay"}),(0,i.jsx)("option",{value:"amazon-pay",children:"Amazon Pay"})]})]})]}),(0,i.jsx)("div",{className:"bg-blue-50 rounded-lg p-4 border border-blue-200",children:(0,i.jsxs)("div",{className:"flex items-center",children:[(0,i.jsx)("svg",{className:"w-5 h-5 text-blue-600 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,i.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"})}),(0,i.jsxs)("div",{className:"flex-1",children:[(0,i.jsx)("h3",{className:"text-sm font-medium text-blue-800",children:"Secure Payment"}),(0,i.jsx)("p",{className:"text-sm text-blue-700 mt-1",children:"Your payment information is encrypted and secure. We do not store your card details."})]})]})})]}),(0,i.jsx)("div",{className:"lg:col-span-1",children:(0,i.jsxs)("div",{className:"bg-white rounded-lg border border-gray-200 p-6 sticky top-4",children:[(0,i.jsx)("h2",{className:"text-xl font-semibold text-gray-900 mb-4",children:"Order Summary"}),(0,i.jsxs)("div",{className:"mb-4 pb-4 border-b border-gray-200",children:[(0,i.jsx)("h3",{className:"font-medium text-gray-900",children:d.name}),(0,i.jsx)("p",{className:"text-sm text-gray-600",children:d.address})]}),(0,i.jsxs)("div",{className:"space-y-3 mb-4 pb-4 border-b border-gray-200",children:[(0,i.jsxs)("div",{className:"flex justify-between",children:[(0,i.jsx)("span",{className:"text-gray-600",children:"Slot Type:"}),(0,i.jsx)("span",{className:"font-medium capitalize",children:a.slotType})]}),(0,i.jsxs)("div",{className:"flex justify-between",children:[(0,i.jsx)("span",{className:"text-gray-600",children:"Duration:"}),(0,i.jsxs)("span",{className:"font-medium",children:[T," hours"]})]}),(0,i.jsxs)("div",{className:"text-sm",children:[(0,i.jsxs)("div",{className:"flex justify-between mb-1",children:[(0,i.jsx)("span",{className:"text-gray-600",children:"Check-in:"}),(0,i.jsxs)("span",{className:"font-medium",children:[P.date," at ",P.time]})]}),(0,i.jsxs)("div",{className:"flex justify-between",children:[(0,i.jsx)("span",{className:"text-gray-600",children:"Check-out:"}),(0,i.jsxs)("span",{className:"font-medium",children:[D.date," at ",D.time]})]})]})]}),a.services&&a.services.length>0&&(0,i.jsxs)("div",{className:"mb-4 pb-4 border-b border-gray-200",children:[(0,i.jsx)("h4",{className:"font-medium text-gray-900 mb-2",children:"Additional Services"}),(0,i.jsx)("div",{className:"space-y-1",children:a.services.map((e,s)=>(0,i.jsxs)("div",{className:"text-sm text-gray-600",children:["Service ",e]},s))})]}),(0,i.jsx)("div",{className:"mb-6",children:(0,i.jsxs)("div",{className:"flex justify-between text-lg font-semibold text-gray-900",children:[(0,i.jsx)("span",{children:"Total Amount:"}),(0,i.jsxs)("span",{children:["\u20b9",a.totalAmount]})]})}),(0,i.jsx)("button",{onClick:async()=>{m(!0);try{if("credit-card"===n){if(!N.holderName||!N.cardNumber||!N.expiryDate||!N.cvv)return alert("Please fill in all card details"),void m(!1)}else if("upi"===n&&!N.upiId)return alert("Please enter your UPI ID"),void m(!1);await new Promise(e=>setTimeout(e,2e3));const e={lotId:d.id,lotName:d.name,address:d.address,startTime:a.startDateTime,endTime:a.endDateTime,slotType:a.slotType,services:a.services||[],totalAmount:a.totalAmount,paymentMethod:n,paymentDetails:"credit-card"===n?{cardLast4:N.cardNumber.slice(-4),cardType:"Credit Card"}:"upi"===n?{upiId:N.upiId}:{wallet:N.walletProvider}};console.log("Payment processed. Showing confirmation before booking creation."),f(e),g(!0)}catch(e){console.error("Payment failed:",e),alert("Payment failed. Please try again.")}finally{m(!1)}},disabled:c,className:"w-full bg-gradient-to-r from-green-600 to-green-700 text-white py-3 px-4 rounded-lg font-medium hover:from-green-700 hover:to-green-800 disabled:from-gray-400 disabled:to-gray-500 disabled:cursor-not-allowed transition-all duration-200 flex items-center justify-center shadow-lg hover:shadow-xl",children:c?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("div",{className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin mr-2"}),"Processing Payment..."]}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("svg",{className:"w-5 h-5 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,i.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"})}),"Pay \u20b9",a.totalAmount," Now"]})}),(0,i.jsxs)("p",{className:"text-xs text-gray-500 mt-3 text-center",children:["By proceeding, you agree to our"," ",(0,i.jsx)("span",{className:"text-blue-600 hover:text-blue-700 cursor-pointer",children:"terms and conditions"})," ","and"," ",(0,i.jsx)("span",{className:"text-blue-600 hover:text-blue-700 cursor-pointer",children:"privacy policy"})]}),(0,i.jsxs)("div",{className:"flex items-center justify-center space-x-4 mt-4 pt-4 border-t border-gray-100",children:[(0,i.jsxs)("div",{className:"flex items-center text-xs text-gray-500",children:[(0,i.jsx)("svg",{className:"w-4 h-4 text-green-500 mr-1",fill:"currentColor",viewBox:"0 0 20 20",children:(0,i.jsx)("path",{fillRule:"evenodd",d:"M2.166 4.999A11.954 11.954 0 0010 1.944 11.954 11.954 0 0017.834 5c.11.65.166 1.32.166 2.001 0 5.225-3.34 9.67-8 11.317C5.34 16.67 2 12.225 2 7c0-.682.057-1.35.166-2.001zm11.541 3.708a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})}),"SSL Secured"]}),(0,i.jsxs)("div",{className:"flex items-center text-xs text-gray-500",children:[(0,i.jsx)("svg",{className:"w-4 h-4 text-blue-500 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,i.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"})}),"PCI Compliant"]})]})]})})]})]})})}}}]);